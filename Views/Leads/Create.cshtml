@model Lead
@{
    ViewData["Title"] = "Dodaj Leada";
}

<h2>Dodaj Nowego Leada</h2>

<form asp-action="Create" method="post" data-val="false">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="mb-3">
        <label>Nazwa Klienta</label>
        <input asp-for="ClientName" class="form-control"/>
        <span asp-validation-for="ClientName" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label>Pochodzenie</label>
        <input asp-for="Source" class="form-control"/>
        <span asp-validation-for="Source" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label>Usługi</label>
        <select name="SelectedServices" class="form-select selectpicker" multiple data-live-search="true">
            @foreach (var s in ViewBag.Services as List<string>)
            {
                var selected = (Model?.Services?.Contains(s) == true) ? "selected" : "";
                @:<option value="@s" @selected>@s</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label>Pakiety</label>
        <select name="SelectedPackages" class="form-select selectpicker" multiple data-live-search="true">
            @foreach (var p in ViewBag.Packages as List<string>)
            {
                var selected = (Model?.Packages?.Contains(p) == true) ? "selected" : "";
                @:<option value="@p" @selected>@p</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label>Numer Umowy</label>
        <input asp-for="ContractNumber" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Osoba Kontaktowa</label>
        <input asp-for="ContactPerson" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Dane Kontaktowe</label>
        <input asp-for="ContactData" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Nadane Dostępy</label>
        <input asp-for="AccessGrantedBy" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Konto Meta/ADS</label>
        <input asp-for="MetaAccount" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Ustalenia Meta/ADS</label>
        <input asp-for="MetaAgreement" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Dane Lokalne</label>
        <input asp-for="LocalData" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Sociale / WWW / Dysk Google</label>
        <textarea asp-for="SocialWebGoogleDrive" class="form-control" rows="5" placeholder="Opis 1|https://link1.com&#10;Opis 2|https://link2.com"></textarea>
        <small class="form-text text-muted">
            Wpisz każdy link w osobnej linii w formacie: <strong>Opis|https://adres</strong><br />
            Przykład:<br />
            Google Drive|https://drive.google.com/s/abc123<br />
            Strona WWW|https://example.com
        </small>
    </div>
    <div class="mb-3">
        <label>Data Rozpoczęcia Umowy</label>
        <div class="input-group" style="max-width: 250px;">
            <input id="serviceStartDate" 
                   name="ServiceStartDate" 
                   class="form-control" 
                   type="text" 
                  placeholder="Wybierz datę" 
                  readonly />
           <span class="input-group-text bg-white" id="startIcon" style="cursor: pointer;">
               <i class="bi bi-calendar3" style="font-size: 1.5rem;"></i>
           </span>
       </div>
        <span asp-validation-for="ServiceStartDate" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label>Data Zakończenia Umowy</label>
        <div class="input-group" style="max-width: 250px;">
            <input id="serviceEndDate" 
                   name="ServiceEndDate" 
                   class="form-control" 
                   type="text" 
                   placeholder="Wybierz datę" 
                   readonly />
           <span class="input-group-text bg-white" id="endIcon" style="cursor: pointer;">
               <i class="bi bi-calendar3" style="font-size: 1.5rem;"></i>
            </span>
        </div>
        <span asp-validation-for="ServiceEndDate" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label>Dodatkowe Informacje</label>
        <textarea asp-for="Notes" class="form-control"></textarea>
    </div>

    <button type="submit" class="btn btn-success">Zapisz</button>
</form>

<a class="btn btn-secondary mt-2" asp-action="Index">Powrót Do Listy</a>

@section Scripts {
    <script>
        $(function () {
            $("input, textarea").removeAttr("data-val");
            $("input, textarea").removeAttr("data-val-required");
        });
        $(document).ready(function () {
            $('.selectpicker').selectpicker();
        });
    </script>
    <script>
        const startPicker = flatpickr("#serviceStartDate", {
            dateFormat: "d.m.Y",
           allowInput: false
       });
    
        const endPicker = flatpickr("#serviceEndDate", {
            dateFormat: "d.m.Y",
            allowInput: false
        });
    
        // klik na ikonę otwiera kalendarz
       document.getElementById("startIcon").addEventListener("click", () => startPicker.open());
        document.getElementById("endIcon").addEventListener("click", () => endPicker.open());
    </script>
    <script>
        const startInput = document.getElementById("serviceStartDate");
        const endInput = document.getElementById("serviceEndDate");
    
       const endPicker = flatpickr(endInput, {
            dateFormat: "d.m.Y",
            allowInput: false
       });
    
        const startPicker = flatpickr(startInput, {
            dateFormat: "d.m.Y",
           allowInput: false,
            onChange: function (selectedDates) {
                if (selectedDates.length > 0) {
                    endPicker.set("minDate", selectedDates[0]);
                    const endDate = endPicker.selectedDates[0];
                    if (endDate && endDate < selectedDates[0]) {
                        endPicker.clear();
                    }
                } else {
                    endPicker.set("minDate", null);
                }
            }
        });
    
        document.getElementById("startIcon").addEventListener("click", () => startPicker.open());
        document.getElementById("endIcon").addEventListener("click", () => endPicker.open());
    </script>
}
